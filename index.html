<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trợ Lý Dịch Khai Thị</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.toast {
  visibility: hidden; min-width: 250px; background: #333; color: #fff;
  text-align: center; border-radius: 8px; padding: 16px;
  position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
  opacity: 0; transition: opacity 0.5s, visibility 0.5s;
}
.toast.show { visibility: visible; opacity: 1; }
.loader {
  border: 4px solid #f3f3f3; border-top: 4px solid #3498db;
  border-radius: 50%; width: 24px; height: 24px;
  animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);}}
</style>
</head>
<body class="bg-yellow-50 font-sans text-gray-800">
<div class="max-w-3xl mx-auto p-4">
  <h1 class="text-2xl font-bold text-center text-teal-700 mb-4">Trợ Lý Dịch Khai Thị</h1>
  <textarea id="chinese-text" rows="8" class="w-full p-3 border rounded mb-3" placeholder="Nhập văn bản tiếng Trung..."></textarea>
  <div id="vietnamese-text" class="w-full min-h-[200px] p-3 border rounded bg-gray-100 whitespace-pre-wrap"></div>
  <div class="flex gap-3 mt-4 justify-center">
    <button id="translate-button" class="bg-teal-600 text-white px-4 py-2 rounded flex items-center">
      <div id="loader" class="loader hidden mr-2"></div>
      <span id="button-text">Dịch văn bản</span>
    </button>
    <button id="copy-button" class="bg-gray-600 text-white px-4 py-2 rounded">Sao chép</button>
  </div>
</div>
<div id="toast" class="toast"></div>

<script>
const btn = document.getElementById('translate-button');
const chineseInput = document.getElementById('chinese-text');
const output = document.getElementById('vietnamese-text');
const loader = document.getElementById('loader');
const buttonText = document.getElementById('button-text');
const toast = document.getElementById('toast');

function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

btn.addEventListener('click', async () => {
  const text = chineseInput.value.trim();
  if (!text) return showToast('Vui lòng nhập văn bản.');

  loader.classList.remove('hidden');
  buttonText.textContent = 'Đang dịch...';
  btn.disabled = true;
  output.textContent = '';

  try {
    const res = await fetch('/api/translate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ chineseText: text })
    });
    if (!res.ok) throw new Error(await res.text());

    const reader = res.body.getReader();
    const decoder = new TextDecoder();

    while(true){
      const {done, value} = await reader.read();
      if(done) break;
      output.textContent += decoder.decode(value, {stream:true});
    }
  } catch(e){
    console.error(e);
    showToast('Lỗi khi dịch: ' + e.message);
  } finally {
    loader.classList.add('hidden');
    buttonText.textContent = 'Dịch văn bản';
    btn.disabled = false;
  }
});

document.getElementById('copy-button').addEventListener('click', async()=>{
  try {
    await navigator.clipboard.writeText(output.textContent);
    showToast('Đã sao chép kết quả!');
  } catch(e){
    showToast('Không thể sao chép.');
  }
});
</script>
</body>
</html>
